# Домашнее задание к занятию 13 «Введение в мониторинг»

## Обязательные задания

### Задание 1

>Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

Следующие метрики необходимы для отслеживания бесперебойного формирования отчетов и обеспечения высокой скорости работы с ними:
- колличество открытых файловых дексрипторов в отношении к их лимиту, если проект развернут на базе Linux подобной операционной системы
- утилизации пространства файлофых систем
- колличество запросов чтение/запись и скорость этих операций для дисков

Так как проект имеет HTTP сервер, необходимо:
- мониторить доступность HTTP сервера
- отношение ошибочных HTTP запросов к общему числу запросов
- время выполнения запросов

Проект требователен к ресурсам CPU, поэтому нам необходимо следить за его утилизацией. Это поможет вовремя среагировать на аномальные привышения показателей или заблаговременно масштабировать стенд проекта, уыеличив тем самым колличество ресурсов CPU:
- загрузка CPU
- средняя загрузка CPU в разрезе нескольких интервалов времени
- iowait CPU

<br>

### Задание 2

>Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

Предложу ему методику и реализацию подсчета SLI на основе этих метрик. Тем самым МП сможет получать легкую в понимании цифру уровня обслуживания, который мы предоставляем клиентам.

<br>

### Задание 3

>Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики, в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

Так как речь идет о системе сбора логов, делаем вывод что приложение может записывать свои ошибки в лог файл.
Предложу несколько вариантов, все зависит от системы мониторинга, которая уже имеется у нас в распоряжении. Мой список будет в порядке убывания от наилучшего варианта к наихудшему (оценивая удобство использования и трудозатраты на реализацию).

1. Если уже есть Zabbix, то предложу внутренней агентской метрикой «log» анализировать строки в лог файле на наличие записей, отвечающих определенному паттерну регулярного выражения. В мониторинг буду попадать конкретные строки с полным текстом ошибки. Если инстанс Zabbix’а высоконагруженный, а по этим ошибкам нужны триггеры или размер базы Zabbix’а сильно ограничен, то предложу внутреннюю агентскую метрику «log.count» которая будет фиксировать только количество ошибок попадающих под паттерн, а не их содержание.

2. Если есть Prometheus подобная система мониторинга, то предложу написать экспортер. Который будет переодически читать лог файл и подсчитывать количество ошибок того или иного типа. Далее полученный результат экспортер будет будет опубликовать по HTTP, либо отправлять timeseries в систему мониторинга по протоколу RemoteWrite, в зависимости от имеющейся сетевой инфраструктуры. Данный вариант ограничен только количеством ошибок и не предоставит разработчикам текст их содержимого. Передавать текст в качестве лейблов я бы не рекомендовал, так как это может непредсказуемо увеличить количество временных серий в БД мониторинга.

3. Если есть в распоряжении любая БД, то написать скрипт, который будет анализировать лог файл на наличие ошибок и записывать результат в эту БД.

4. Если нет вообще ничего, то написать скрипт который будет анализировать лог файл на наличие ошибок и записывать результат в текстовый файл.

<br>

### Задание 4

>Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов. Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Я забыл учесть в подсчете информационные коды возврата (1xx) и коды редиректов (3xx).

<br>
<br>

## Дополнительное задани

[Скрипт python3](https://github.com/cachmc/netology_devops_homework/tree/main/05-monitoring/01-base/src/monitoring_linux.py)

```bash
*/1 * * * * python3 /opt/monitoring_linux.py
```

![Скриншот 1](https://github.com/cachmc/netology_devops_homework/raw/main/05-monitoring/01-base/pictures/task-01.png)
